"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[265],{62730:function(da,ie,o){o.r(ie);var ke=o(43953),h=o.n(ke),Ue=o(91184),O=o.n(Ue),Ae=o(9083),S=o.n(Ae),We=o(23539),M=o(25805),le=o(23273),U=o(14805),D=o(41028),A=o(91841),$=o(67504),W=o(321),B=o(49227),N=o(59725),se=o(5257),oe=o(99808),g=o(38497),a=o(96469),F=o(1982).lW,E=[],C=0,Le=function(){var V,G,Y,Q,fa=(0,g.useRef)(null),w=(0,g.useRef)(null),Ke=(0,g.useState)({baudRate:460800,dataBits:8,stopBits:1,parity:"none",bufferSize:1024,flowControl:"none"}),de=S()(Ke,2),e=de[0],T=de[1],c=(0,We.useIntl)(),ze=(0,g.useState)(),ue=S()(ze,2),v=ue[0],fe=ue[1],$e=(0,g.useState)(void 0),ce=S()($e,2),f=ce[0],Ne=ce[1],He=(0,g.useState)(void 0),ge=S()(He,2),t=ge[0],Fe=ge[1],Ve=(0,g.useState)(!1),pe=S()(Ve,2),Z=pe[0],I=pe[1],Ge=(0,g.useState)(!1),he=S()(Ge,2),k=he[0],ca=he[1],Ye=(0,g.useState)(!1),ve=S()(Ye,2),me=ve[0],Qe=ve[1],Xe=(0,g.useState)(!1),be=S()(Xe,2),X=be[0],Je=be[1],qe=(0,g.useState)("".concat(c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"No serial port selected"}))),Ce=S()(qe,2),ea=Ce[0],ye=Ce[1],aa=(0,g.useState)(""),Se=S()(aa,2),L=Se[0],_=Se[1],ra=(0,g.useState)(""),we=S()(ra,2),J=we[0],na=we[1],xe="ds-terminal1",Ee="ds-terminal2",q=new TextEncoder;(0,g.useEffect)(function(){navigator.serial||M.ZP.warning("\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u4E32\u53E3\u64CD\u4F5C,\u8BF7\u66F4\u6362Edge\u6216Chrome\u6D4F\u89C8\u5668")},[]),(0,g.useMemo)(function(){setTimeout(function(){t==null||t.fit()},200)},[k]),(0,g.useMemo)(function(){var i=function(){var r=O()(h()().mark(function d(){var l,u;return h()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:l=8192,u=h()().mark(function y(){var j,s;return h()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:p.prev=0;try{w.current=v.readable.getReader({mode:"byob"})}catch(K){w.current=v.readable.getReader()}j=null,s=h()().mark(function K(){var ee,x,Pe,Be,je,ae,Oe,De,H,re,ne,Te,Ze;return h()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,O()(h()().mark(function P(){var te,z,Ie;return h()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(!(w.current instanceof ReadableStreamBYOBReader)){R.next=11;break}return j||(j=new ArrayBuffer(l)),R.next=4,w.current.read(new Uint8Array(j,0,l));case 4:return te=R.sent,z=te.value,Ie=te.done,j=z==null?void 0:z.buffer,R.abrupt("return",{value:z,done:Ie});case 11:return R.next=13,w.current.read();case 13:return R.abrupt("return",R.sent);case 14:case"end":return R.stop()}},P)}))();case 2:if(ee=b.sent,x=ee.value,Pe=ee.done,!x){b.next=31;break}return b.next=8,new Promise(function(P){f==null||f.writeString(x,P)});case 8:if(!t){b.next=31;break}if(!(x.length>=2)){b.next=31;break}if(Be=x[x.length-1],je=x[x.length-2],!(Be===10&&je===13)){b.next=24;break}if(ae=x.subarray(0,x.length-2),!(ae.length>0)){b.next=20;break}return Oe=F.from(ae).toString("hex"),b.next=18,new Promise(function(P){t==null||t.writeString(Oe,P)});case 18:b.next=22;break;case 20:return b.next=22,new Promise(function(P){t==null||t.writeString(`\r
`,P)});case 22:b.next=27;break;case 24:return De=F.from(x).toString("hex"),b.next=27,new Promise(function(P){t==null||t.writeString(De,P)});case 27:H=t==null?void 0:t.getImageString(),re=H.indexOf("232323"),ne=H.indexOf("242424"),re>0&&ne>0&&(Te=F.from(H.substring(re+6,ne),"hex"),Ze="data:image/png;base64,".concat(Te.toString("base64")),t==null||t.clearImageString(),setCurrentImage(Ze),setCurrentImageName("ids-shot-".concat(new Date().toISOString()+".jpeg")));case 31:if(!Pe){b.next=33;break}return b.abrupt("return",1);case 33:case"end":return b.stop()}},K)});case 4:return p.delegateYield(s(),"t0",5);case 5:if(!p.t0){p.next=7;break}return p.abrupt("break",9);case 7:p.next=4;break;case 9:p.next=16;break;case 11:return p.prev=11,p.t1=p.catch(0),console.error(p.t1),p.next=16,new Promise(function(K){p.t1 instanceof Error&&(f==null||f.writeString("<ERROR: ".concat(p.t1.message,">"),K),t==null||t.writeString("<ERROR: ".concat(p.t1.message,">"),K))});case 16:return p.prev=16,w.current&&(w.current.releaseLock(),w.current=void 0),p.finish(16);case 19:case"end":return p.stop()}},y,null,[[0,11,16,19]])});case 2:if(!(v&&v!==null&&v!==void 0&&v.readable)){m.next=6;break}return m.delegateYield(u(),"t0",4);case 4:m.next=2;break;case 6:case"end":return m.stop()}},d)}));return function(){return r.apply(this,arguments)}}();Z&&(w.current||i().then())},[Z]);var _e=function(){var i=O()(h()().mark(function r(){var d,l;return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(v&&f)){n.next=29;break}if(!f){n.next=18;break}return n.next=4,(d=w.current)===null||d===void 0?void 0:d.cancel();case 4:return n.prev=4,n.next=7,v.close();case 7:return n.next=9,v.forget();case 9:fe(void 0),ye("\u672A\u9009\u62E9\u4E32\u53E3"),n.next=17;break;case 13:n.prev=13,n.t0=n.catch(4),console.error(n.t0),n.t0 instanceof Error&&f.writeln("<ERROR: ".concat(n.t0.message,">"));case 17:I(!1);case 18:if(!t){n.next=29;break}return n.prev=19,n.next=22,(l=w.current)===null||l===void 0?void 0:l.cancel();case 22:n.next=28;break;case 24:n.prev=24,n.t1=n.catch(19),console.error(n.t1),n.t1 instanceof Error&&t.writeln("<ERROR: ".concat(n.t1.message,">"));case 28:I(!1);case 29:case"end":return n.stop()}},r,null,[[4,13],[19,24]])}));return function(){return i.apply(this,arguments)}}(),ta=function(){var i=O()(h()().mark(function r(){var d,l;return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,_e(),n.next=4,navigator.serial.requestPort();case 4:d=n.sent,d&&(l=d.getInfo(),ye("".concat(c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Selected"})," : ").concat(l.usbProductId,"-").concat(l.usbVendorId)),fe(d)),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),n.t0 instanceof Error&&M.ZP.error("".concat(c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Get serial port error"})," : ").concat(n.t0.message));case 11:case"end":return n.stop()}},r,null,[[0,8]])}));return function(){return i.apply(this,arguments)}}(),ia=function(){var i=O()(h()().mark(function r(){var d,l,u,n,m,y;return h()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(v&&e)){s.next=37;break}return s.prev=1,s.next=4,v.open(e);case 4:if(f){s.next=15;break}return s.next=7,Promise.all([o.e(856),o.e(961)]).then(o.bind(o,4172));case 7:d=s.sent,l=d.TerminalClass,u=new l({theme:{selectionBackground:"#f4ea2a"}},xe),Ne(u),u==null||u.writeln("<CONNECTED>"),I(!0),s.next=17;break;case 15:f==null||f.writeln("<CONNECTED>"),I(!0);case 17:if(t){s.next=28;break}return s.next=20,Promise.all([o.e(856),o.e(961)]).then(o.bind(o,4172));case 20:n=s.sent,m=n.TerminalClass,y=new m({theme:{selectionBackground:"#f4ea2a"}},Ee),Fe(y),y==null||y.writeln("<CONNECTED>"),I(!0),s.next=30;break;case 28:t==null||t.writeln("<CONNECTED>"),I(!0);case 30:s.next=35;break;case 32:s.prev=32,s.t0=s.catch(1),s.t0 instanceof Error&&M.ZP.error("\u4E32\u53E3\u5F02\u5E38\u5173\u95ED\uFF0C\u8BF7\u5237\u65B0\u9875\u9762 "+s.t0.message);case 35:s.next=39;break;case 37:M.ZP.warning("\u8BF7\u5148\u9009\u62E9\u4E32\u53E3"),_("");case 39:case"end":return s.stop()}},r,null,[[1,32]])}));return function(){return i.apply(this,arguments)}}(),la=function(){var i=O()(h()().mark(function r(){var d;return h()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(L.length>0&&(E.push(L),C=E.length),!(v&&v.writable)){u.next=8;break}return d=v.writable.getWriter(),d.write(q.encode(L)),X&&d.write(q.encode(`\r
`)),d.releaseLock(),_(""),u.abrupt("return");case 8:M.ZP.warning("\u8BF7\u5148\u9009\u62E9\u4E32\u53E3"),_("");case 10:case"end":return u.stop()}},r)}));return function(){return i.apply(this,arguments)}}(),sa=function(){var i=O()(h()().mark(function r(){var d,l,u,n;return h()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(v&&v.writable)){y.next=13;break}if(d=L.replace(/\s+/g,""),!(/^[0-9A-Fa-f]+$/.test(d)&&d.length%2===0)){y.next=11;break}for(l=[],u=0;u<d.length;u=u+2)l.push(parseInt(d.substring(u,u+2),16));return n=v.writable.getWriter(),n.write(Uint8Array.from(l)),X&&n.write(q.encode(`\r
`)),n.releaseLock(),_(""),y.abrupt("return");case 11:return M.ZP.warning("\u8BF7\u8F93\u5165\u6709\u6548\u4FE1\u606F"),y.abrupt("return");case 13:M.ZP.warning("\u8BF7\u5148\u9009\u62E9\u4E32\u53E3"),_("");case 15:case"end":return y.stop()}},r)}));return function(){return i.apply(this,arguments)}}(),oa=function(){var r=f==null?void 0:f.getCacheString(),d=t==null?void 0:t.getCacheString();if(r&&d){var l=document.querySelector("body	"),u=new Blob([r],{type:"text/plain;charset=utf-8"}),n=new Date().toISOString()+".raw.log",m=document.createElement("a");m.href=window.URL.createObjectURL(u),m.download=n,m.style.display="none",l==null||l.appendChild(m),m.click(),l==null||l.removeChild(m),window.URL.revokeObjectURL(m.href);var y=new Blob([d],{type:"text/plain;charset=utf-8"}),j=new Date().toISOString()+".hex.log",s=document.createElement("a");s.href=window.URL.createObjectURL(y),s.download=j,s.style.display="none",l==null||l.appendChild(s),s.click(),l==null||l.removeChild(s),window.URL.revokeObjectURL(s.href)}else M.ZP.warning("\u6CA1\u6709\u53EF\u4EE5\u4FDD\u5B58\u7684\u65E5\u5FD7")},Re=function(){f==null||f.find(J),t==null||t.find(J)},Me=function(){v&&e&&f?me?sa():la():(M.ZP.warning("\u8BF7\u5148\u9009\u62E9\u4E32\u53E3"),_(""))};return(0,a.jsxs)(le.Z,{gutter:8,style:{display:"flex",flexDirection:"row",justifyContent:"flex-start"},children:[(0,a.jsxs)(U.Z,{span:6,style:{display:"flex",flexDirection:"column",justifyContent:"flex-start",paddingRight:8,borderRadius:2,minHeight:"40rem"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(D.Z,{placeholder:"0",type:"number",value:e==null?void 0:e.baudRate.toString(),onChange:function(r){return T({baudRate:parseInt(r.target.value),dataBits:e.dataBits,stopBits:e.stopBits,parity:e.parity,bufferSize:e.bufferSize,flowControl:e.flowControl})},addonBefore:(0,a.jsx)(A.Z.Text,{children:c.formatMessage({id:"pages.terminal.baud-rate"})}),addonAfter:(0,a.jsx)(g.Fragment,{children:(0,a.jsx)($.Z,{options:[{value:9600,label:9600},{value:14400,label:14400},{value:19220,label:19220},{value:28800,label:28800},{value:38400,label:38400},{value:57600,label:57600},{value:115200,label:115200},{value:230400,label:230400},{value:460800,label:460800},{value:921600,label:921600}],style:{marginRight:-8},value:e==null?void 0:e.baudRate.toString(),defaultValue:e==null?void 0:e.baudRate.toString(),onChange:function(r){r&&T({baudRate:parseInt(r),dataBits:e.dataBits,stopBits:e.stopBits,parity:e.parity,bufferSize:e.bufferSize,flowControl:e.flowControl})}})})}),(0,a.jsx)(W.Z,{type:"horizontal",style:{marginTop:8,marginBottom:8}}),(0,a.jsx)(D.Z,{placeholder:"0",type:"number",onChange:function(r){return T({baudRate:e.baudRate,dataBits:parseInt(r.target.value),stopBits:e.stopBits,parity:e.parity,bufferSize:e.bufferSize,flowControl:e.flowControl})},value:e==null||(V=e.dataBits)===null||V===void 0?void 0:V.toString(),addonBefore:(0,a.jsx)(A.Z.Text,{color:"neutral",children:c.formatMessage({id:"pages.terminal.data-bits"})}),addonAfter:(0,a.jsx)(g.Fragment,{children:(0,a.jsx)($.Z,{value:e==null||(G=e.dataBits)===null||G===void 0?void 0:G.toString(),defaultValue:e==null||(Y=e.dataBits)===null||Y===void 0?void 0:Y.toString(),options:[{value:5,label:5},{value:6,label:6},{value:7,label:7},{value:8,label:8}],onChange:function(r){r&&T({baudRate:e.baudRate,dataBits:parseInt(r),stopBits:e.stopBits,parity:e.parity,bufferSize:e.bufferSize,flowControl:e.flowControl})},style:{marginRight:-8}})})}),(0,a.jsx)(W.Z,{type:"horizontal",style:{marginTop:8,marginBottom:8}}),(0,a.jsx)(D.Z,{placeholder:"0",type:"number",value:e==null||(Q=e.bufferSize)===null||Q===void 0?void 0:Q.toString(),onChange:function(r){return T({baudRate:e.baudRate,dataBits:e.dataBits,stopBits:e.stopBits,parity:e.parity,bufferSize:parseInt(r.target.value),flowControl:e.flowControl})},addonBefore:(0,a.jsx)(A.Z.Text,{color:"neutral",children:c.formatMessage({id:"pages.terminal.buffer"})})}),(0,a.jsx)(W.Z,{type:"horizontal",style:{marginTop:8,marginBottom:8}}),(0,a.jsx)(D.Z,{placeholder:"0",value:e==null?void 0:e.parity,addonBefore:(0,a.jsx)(A.Z.Text,{color:"neutral",children:c.formatMessage({id:"pages.terminal.check-digit"})}),addonAfter:(0,a.jsx)(g.Fragment,{children:(0,a.jsx)($.Z,{value:e==null?void 0:e.parity,defaultValue:e==null?void 0:e.parity,options:[{label:"none",value:"none"},{label:"even",value:"even"},{label:"odd",value:"odd"}],onChange:function(r){r&&T({baudRate:e.baudRate,dataBits:e.dataBits,stopBits:e.stopBits,parity:r,bufferSize:e.bufferSize,flowControl:e.flowControl})},style:{marginRight:-1.5}})})}),(0,a.jsx)(W.Z,{type:"horizontal",style:{marginTop:8,marginBottom:8}}),(0,a.jsx)(D.Z,{placeholder:"0",value:e==null?void 0:e.flowControl,addonBefore:(0,a.jsx)(A.Z.Text,{color:"neutral",children:c.formatMessage({id:"pages.terminal.flow-control"})}),addonAfter:(0,a.jsx)(g.Fragment,{children:(0,a.jsx)($.Z,{value:e==null?void 0:e.flowControl,defaultValue:e==null?void 0:e.flowControl,onChange:function(r){r&&T({baudRate:e.baudRate,dataBits:e.dataBits,stopBits:e.stopBits,parity:e.parity,bufferSize:e.bufferSize,flowControl:r})},style:{marginRight:-1.5},options:[{label:"none",value:"none"},{label:"hardware",value:"hardware"}]})})})]}),(0,a.jsx)(W.Z,{type:"horizontal",style:{marginTop:8}}),(0,a.jsxs)(le.Z,{gutter:8,style:{marginTop:0},children:[(0,a.jsx)(U.Z,{span:8,children:(0,a.jsx)(B.ZP,{type:"primary",onClick:function(){return ta()},style:{width:"100%"},children:c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Choose"})})}),(0,a.jsx)(U.Z,{span:8,children:(0,a.jsx)(B.ZP,{type:"primary",disabled:!Z,onClick:function(){return _e()},style:{width:"100%"},children:c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Close"})})}),(0,a.jsx)(U.Z,{span:8,style:{justifyContent:"flex-end"},children:(0,a.jsx)(B.ZP,{color:"neutral",disabled:!!Z,onClick:function(){return ia()},style:{width:"100%",marginLeft:1},children:c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Open"})})})]}),(0,a.jsx)(N.Z,{style:{height:"66px",width:"100%",marginTop:12},children:ea}),(0,a.jsx)(N.Z,{style:{height:"66px",width:"100%",marginTop:12},color:Z?"warning":"success",children:Z?"".concat(c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Serial port connected"})):"".concat(c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Serial port disconnected"}))})]}),(0,a.jsxs)(U.Z,{span:18,style:{justifyContent:"flex-start",flexDirection:"column",display:"flex",borderRadius:2,paddingLeft:8,paddingRight:8,minWidth:"40%",height:"100%"},children:[(0,a.jsx)(N.Z,{title:c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Logs"}),extra:(0,a.jsxs)(se.Z,{children:[(0,a.jsx)(D.Z,{placeholder:c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Search Logs"}),onChange:function(r){return na(r.target.value)},onKeyDown:function(r){r.key==="Enter"&&Re()},value:J,style:{width:"100%",height:32}}),(0,a.jsx)(B.ZP,{color:"neutral",onClick:function(){return Re()},style:{minWidth:"100px"},children:"".concat(c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Search"}))}),(0,a.jsx)(B.ZP,{type:"primary",onClick:function(){return oa()},style:{minWidth:"100px"},children:"".concat(c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Save"}))}),(0,a.jsx)(B.ZP,{type:"primary",onClick:function(){f==null||f.clearLog(),t==null||t.clearLog()},style:{minWidth:"100px"},children:"".concat(c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Clean Screen"}))})]}),styles:{body:{padding:0,height:"70vh"}},children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",width:"100%",height:"100%"},children:[(0,a.jsx)("div",{id:xe,style:{marginRight:k?4:0,borderRadius:16,border:1,borderColor:"#fff",width:k?"50%":"100%",height:"70vh"}}),k?(0,a.jsx)("div",{id:Ee,style:{marginLeft:k?4:0,borderRadius:16,border:1,width:k?"50%":"100%",height:"100%"}}):(0,a.jsx)("div",{style:{height:"430px"}})]})}),(0,a.jsxs)(N.Z,{style:{marginTop:40,height:"120px"},children:[(0,a.jsx)(D.Z,{color:"neutral",placeholder:"".concat(c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Enter the content to be sent"})),onChange:function(r){return _(r.target.value)},onKeyDown:function(r){r.key==="ArrowUp"&&(C--,C<0&&(C=0),E[C]&&(console.log("\u2191 "+C+E[C]),_(E[C]))),r.key==="ArrowDown"&&(C++,C>=E.length&&(C=E.length-1),C<0&&(C=0),E[C]&&(console.log("\u2193"+C+E[C]),_(E[C]))),r.key==="Enter"&&Me()},value:L,style:{width:"100%",height:"32px"}}),(0,a.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,a.jsxs)(se.Z,{align:"start",style:{marginTop:12,paddingLeft:0},children:[(0,a.jsx)(oe.Z,{style:{minWidth:"120px",height:"100%",marginTop:8},checked:me,onChange:function(r){Qe(r.target.checked)},children:"WRITE HEX"}),(0,a.jsx)(oe.Z,{style:{minWidth:"120px",height:"100%",marginTop:8},checked:X,onChange:function(r){Je(r.target.checked)},children:"Attach \\r\\n"}),(0,a.jsx)(B.ZP,{style:{minWidth:"100px"},onClick:function(){_("")},children:"".concat(c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Clear Input"}))}),(0,a.jsx)(B.ZP,{type:"primary",style:{minWidth:"100px"},onClick:Me,children:"".concat(c.formatMessage({id:"pages.terminal.xxx",defaultMessage:"Sent"}))})]})})]})]})]})};ie.default=Le}}]);
